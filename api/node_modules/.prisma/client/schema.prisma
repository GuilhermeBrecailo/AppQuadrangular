generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL") // <--- CERTO (Sem aspas por fora)
}

// Contexto de Identidade (Auth)
model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String // Hash
  createdAt DateTime @default(now())

  // Isso te dá poder para criar igrejas e ver tudo, ignorando as regras de Tenant.
  isSuperAdmin Boolean @default(false)

  // Relacionamento com as igrejas
  memberships Member[]
}

// Contexto da Organização (Tenant)
model Church {
  id        String   @id @default(uuid())
  name      String
  slug      String   @unique // ex: 'batista-central' (útil para URLs)
  createdAt DateTime @default(now())

  members     Member[]
  departments Department[] // Ministérios (Louvor, Infantil, etc)
}

// O Vínculo (Aonde a hierarquia acontece)
model Member {
  id String @id @default(uuid())

  userId String
  user   User   @relation(fields: [userId], references: [id])

  churchId String
  church   Church @relation(fields: [churchId], references: [id])

  role ChurchRole @default(MEMBER)

  // Se for um Líder, ele pode estar vinculado a um departamento específico
  ledDepartments Department[]

  @@unique([userId, churchId]) // Garante que o user só tem 1 perfil nesta igreja
}

model Department {
  id   String @id @default(uuid())
  name String // Ex: "Ministério de Louvor"

  churchId String
  church   Church @relation(fields: [churchId], references: [id])

  // Quem lidera este departamento?
  leaderId String?
  leader   Member? @relation(fields: [leaderId], references: [id])

  @@index([churchId])
}

// Hierarquia de Poder
enum ChurchRole {
  PASTOR // Admin do Tenant: Cria departamentos, adiciona membros, vê tudo daquela igreja.
  LEADER // Gerente: Controla apenas o seu departamento (escala, ensaios).
  MEMBER // Usuário: Apenas visualiza suas escalas e recebe notificações.
}
